{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/posts/posts_list.css' %}">
{% endblock %}

{% block content %}
{# Header moved to global partial included in base.html #}

<div class="info-container">
    <div class="info-header">
        {% if type_code == "club" %}
        <h2>동아리 활동 모음</h2>
        <p>다양한 동아리 활동을 찾아보고, 나에게 맞는 동아리에 신청해보세요.</p>
        {% elif type_code == "external" %}
        <h2>대외활동 모음</h2>
        <p>기업/기관의 대외활동 정보를 모아 보여드립니다. 참여 기회를 확인해보세요.</p>
        {% elif type_code == "bootcamp" %}
        <h2>부트캠프 활동 모음</h2>
        <p>단기 집중 교육(부트캠프) 정보를 확인하고 신청해보세요.</p>
        {% else %}
        <h2>IT 활동 모음</h2>
        <p>동아리, 대외활동, 부트캠프 등 다양한 IT 활동 정보를 한눈에 확인하세요.</p>
        {% endif %}
    </div>

    <div class="search-bar">
        <select name="category">
            <option value="">전공/직무</option>
            <option value="ai">인공지능</option>
            <option value="web">웹 개발</option>
            <option value="data">데이터 분석</option>
        </select>
        <input type="text" placeholder="키워드를 입력하세요">
        <button type="submit" class="btn-search">검색</button>
    </div>

    <div class="activity-grid">

        {# Example static cards from main/listPage (kept as placeholders) #}
        <div class="activity-card">
            <div class="card-author">
                <img src="{% static 'images/avatars/andi.png' %}" alt="프로필">
                <div>
                    <strong>Andi Antenmae</strong>
                    <span>인공지능</span>
                </div>
            </div>
            <p class="card-description">안녕하세요. 저희 동아리는 인공지능 전공자들로 이루어진 동아리입니다. 관심이 있으시다면 신청해주세요.</p>
        </div>

        {# (other example cards omitted for brevity) #}

    </div>
    <hr class="dotted-divider">
</div>

{# --- Existing posts hero + filter + posts list --- #}
<section class="hero-section" {% if type_code %}data-type="{{ type_code }}" {% endif %}>

    <!-- 필터: 라디오 버튼 UI -->
    <div class="filter-bar" style="margin-bottom: 20px;">
        <div style="margin-bottom: 10px;">
            <a href="/posts/" class="filter-page-btn">전체</a>
            <a href="/posts/type/club/" class="filter-page-btn">동아리</a>
            <a href="/posts/type/external/" class="filter-page-btn">대외활동</a>
            <a href="/posts/type/bootcamp/" class="filter-page-btn">부트캠프</a>
        </div>
        <span>모집 분야:</span>
        <button type="button" class="field-btn" data-field="BACKEND">백엔드</button>
        <button type="button" class="field-btn" data-field="FRONTEND">프론트엔드</button>
        <button type="button" class="field-btn" data-field="DESIGN">디자인</button>
        <button type="button" class="field-btn" data-field="PM">PM</button>
        <button type="button" class="field-btn" data-field="AI_ML">AI/ML</button>

        <span style="margin-left:20px;">지원 기간(분기):</span>
        <button type="button" class="quarter-btn" data-quarter="1분기">1분기</button>
        <button type="button" class="quarter-btn" data-quarter="2분기">2분기</button>
        <button type="button" class="quarter-btn" data-quarter="3분기">3분기</button>
        <button type="button" class="quarter-btn" data-quarter="4분기">4분기</button>

        <span style="margin-left:20px;">신청 자격:</span>
        <button type="button" class="eligibility-btn" data-eligibility="STUDENT">대학생</button>
        <button type="button" class="eligibility-btn" data-eligibility="GRADUATE">졸업생</button>
        <button type="button" class="eligibility-btn" data-eligibility="WORKER">직장인</button>

        <span style="margin-left:20px;">요구 개발 레벨:</span>
        <button type="button" class="level-btn" data-level="NOVICE">초심자</button>
        <button type="button" class="level-btn" data-level="INTERMEDIATE">중급자</button>
        <button type="button" class="level-btn" data-level="ADVANCED">고급자</button>
    </div>

    <!-- 리스트 영역 (인라인 구현) -->
    <div id="posts-list-container">
    </div>
</section>
{% endblock %}

{% block extra_js %}

<script>
    function collectActiveValues(selector, dataKey) {
        const els = Array.from(document.querySelectorAll(selector));
        const active = els.filter(e => e.classList.contains('active')).map(e => e.dataset[dataKey]);
        if (active.length === 0) return '';
        return active.join(',');
    }

    function sendFilterAjax() {
        const field = collectActiveValues('.field-btn', 'field');
        const quarter = collectActiveValues('.quarter-btn', 'quarter');
        const eligibility = collectActiveValues('.eligibility-btn', 'eligibility');
        const level = collectActiveValues('.level-btn', 'level');
        const section = document.querySelector('section.hero-section');
        const type = section?.dataset.type || 'ALL';
        const params = new URLSearchParams();
        params.set('type', type);
        params.set('field', field);
        params.set('quarter', quarter);
        params.set('eligibility', eligibility);
        params.set('level', level);
        const url = `/posts/ajax_list/?${params.toString()}`;
        fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
            .then(r => r.text())
            .then(html => {
                const container = document.getElementById('posts-list-container');
                if (container) container.innerHTML = html;
            })
            .catch(err => console.error('Filter AJAX error', err));
    }

    function setupToggleGroup(buttonSelector, dataKey) {
        const buttons = Array.from(document.querySelectorAll(buttonSelector));
        if (!buttons.length) return;
        buttons.forEach(btn => {
            btn.addEventListener('click', function () {
                btn.classList.toggle('active');
                sendFilterAjax();
            });
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        setupToggleGroup('.field-btn', 'field');
        setupToggleGroup('.quarter-btn', 'quarter');
        setupToggleGroup('.eligibility-btn', 'eligibility');
        setupToggleGroup('.level-btn', 'level');
        // 필터 버튼 모두 off 상태로 시작 (active 클래스 제거)
        document.querySelectorAll('.field-btn, .quarter-btn, .eligibility-btn, .level-btn').forEach(function (btn) {
            btn.classList.remove('active');
        });
        sendFilterAjax();
    });
</script>

{% endblock %}
